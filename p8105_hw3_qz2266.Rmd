---
title: "p8105_hw3_qz2266"
author: "Qing Zhou"
date: "2022-10-15"
output: github_document
---


```{r, message = FALSE}
library(tidyverse)
library(lubridate)
library(p8105.datasets)
library(readxl)
knitr::opts_chunk$set(echo = TRUE)
```

# Problem 2

## Load, tidy, and wrangle the data. 

```{r}
accel = 
  read_csv("data/accel_data.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(
    activity_1:activity_1440,
    names_to = "act_minute",
    values_to = "act_count") %>%
 
  mutate(
    day_type = case_when(
      day == "Monday" ~ "weekday",
      day == "Tuesday" ~ "weekday",
      day == "Wednesday" ~ "weekday",
      day == "Thursday" ~ "weekday",
      day == "Friday" ~ "weekday",
      day == "Saturday" ~ "weekend",
      day == "Sunday" ~ "weekend" ,
      TRUE     ~ ""
  )) %>%
  
  mutate(
    week = as.integer(week),
    day_id = as.integer(day_id),
    day = factor(day, levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")),
    day_type = factor(day_type, levels = c("weekday", "weekend"))) %>% 
  relocate(week,day_id, day, day_type)
```


The data set has `r nrow(accel)` observations, and contains `r ncol(accel)` variables, including `r colnames(accel)`. Data was collected across `r accel %>% summarise(count = n_distinct(day_id))` days of `r accel %>% summarise(count = n_distinct(week))` weeks.

There are four date variables :  

* day_id is a `r class(pull(accel,day_id))` variable that indicates the day when data was collected;
* day is a `r class(pull(accel,day))` variable  that indicates which day it is when data was collected;
* week is a `r class(pull(accel, week))` variable that indicates the week when data was collected.
* day_type is a `r class(pull(accel, day_type))` variable that indicates the information was collected on weekend or weekday.

There are two activity variables :

* act_minute is a `r class(pull(accel, act_minute))` variable that indicates the minute when the activity count was collected, corresponding to each minute of a 24-hour day starting at midnight.
* On each day, there are `r accel %>% filter(day_id == 1) %>% summarise(count = n_distinct(act_minute))` activity counts for each minute of a 24-hour day starting at midnight, and the corresponding value is stored in act_count, which is a `r class(pull(accel, act_count))` variable.

## The total activity over the day


```{r}
library(dplyr, warn.conflicts = FALSE)

options(dplyr.summarise.inform = FALSE)

total_act =
  accel %>%
  group_by(week, day) %>%
  dplyr::summarise(total_activity = sum(act_count)) %>% 
  pivot_wider(
    names_from = "day", 
    values_from = "total_activity")

```


We couldn't see a clear tendency over days. However, we could roughly find that the total activity across 5 weeks is high on Wednesday, Thursday and Friday, and low in Saturday. The total activity seemed to peak on Friday but quickly drop to the bottom on Saturday.  

More specifically, the total activity sum of Sunday is `r sum(total_act[, 'Sunday'])`, of Saturday is `r sum(total_act[, 'Saturday'])`, of Monday is `r sum(total_act[, 'Monday'])`, of Tuesday is `r sum(total_act[, 'Tuesday'])`, of Wednesday is `r sum(total_act[, 'Wednesday'])`, of Thursday is `r sum(total_act[, 'Thursday'])`, and of Friday is `r sum(total_act[, 'Friday'])`.

The user is relatively more active at the beginning of the study than later on. On Saturdays of week 4 and 5, the data were much lower than the rest. There might be some problem with the measurement, such as incorrect use of the device. 

## Make a single-panel plot to show the 24-hour activity time courses for each day.

### If use time points as the x-axis:
```{r accel_mean_plot}
accel_mean_plot = 
  accel %>%
  separate(act_minute, into = c("activity", "act_min")) %>%
  select(-activity) %>%
  mutate(
    act_min = as.numeric(act_min)) %>%
  group_by(day, act_min) %>% 
  dplyr::summarise(avg_count = mean(act_count))

accel_mean_plot %>%
  ggplot(aes(x = act_min, y = avg_count, color = day)) + 
  geom_point() +
  geom_line(alpha = 0.5) +
  labs(
    title = "24-hour Activity Count by Day",
    x = "Time Course",
    y = "Activity Count"
  ) + 
  scale_x_continuous(
    breaks = c(0, 360, 720, 1080, 1440), 
    labels = c("12AM", "6AM", "12PM", "6PM", "11:59PM"),
    limits = c(0, 1440)
    )
```

### If use Minute as the x-axis:
```{r accel_mean_plot2}
accel_mean_plot2 = 
  accel %>%
  separate(act_minute, into = c("activity", "act_min")) %>%
  select(-activity) %>%
  mutate(
    act_min = as.numeric(act_min)) %>%
  group_by(day, act_min) %>% 
  dplyr::summarise(avg_count = mean(act_count))

accel_mean_plot2 %>%
  ggplot(aes(x = act_min, y = avg_count, color = day)) + 
  geom_point() +
  geom_line(alpha = 0.5) +
  labs(
    title = "24-hour Activity Count by Day",
    x = "Minute",
    y = "Activity Count"
    )
```

# Another solution:

```{r accel_plot}
accel_plot = 
  accel %>%
  separate(act_minute, into = c("activity", "act_min")) %>%
  select(-activity) %>%
  mutate(
    act_min = as.numeric(act_min))

accel_plot %>%
  group_by(day_id) %>%
  ggplot(aes(x = act_min, y = act_count, color = day)) +
  geom_point() +
  geom_line() +
  
  labs(
    title = "24-hour Activity Count by Day",
    x = "Minute",
    y = "Activity Count"
  )
```

From the plot we could see the activity count at most time points are below 2500.There are three peaks located around 7-8AM, 12PM and 8-9pm. Especially on Friday, there is an obvious peak around 8-9pm. Moreover, at nights from 12AM to 5AM, the activity counts are pretty low. It might be because this time slot is the sleeping hour.
